{% extends "layout/base.html" %}
{% load staticfiles %}

{% block content %}
<div class="section-definer-light">
  <div class="container-fluid">
    <div class="boxes-navbar-container">
      <div class="head-navbar row">
        <div class="col-xs-8 col-sm-5 start-xs">
          <h2 class="text-lightest title">Manage Boxes</h2>
        </div>
        <div class="col-xs-4 col-sm-1">
          <a class="box__nav box__nav__item smalltext md-trigger outro" {% if request.user.has_setup_complete %} data-modal="modal-1" {% else %} href="{% url 'humans_update' %}?setup=1" {% endif %}>New</a>
        </div>
      </div>
      <ul class="box__nav smalltext">
        <div class="row no-padding">
          <div class="center-xs col-xs-12 flex-d">
            <li class="full-width"><a href="{% url "boxes_list" %}?display=Open" class="box__nav__item {% if display_status == 'Open' %}active{% endif %}">Open</a></li>
            <li class="full-width" ><a href="{% url "boxes_list" %}?display=Done"class="box__nav__item {% if display_status == 'Done' %}active{% endif %}">Done</a></li>
            <li class="full-width"><a href="{% url "boxes_list" %}?display=Expired" class="box__nav__item {% if display_status == 'Expired' %}active{% endif %}">Expired</a></li>
            <li class="full-width" ><a href="{% url "boxes_list" %}?display=Closed" class="box__nav__item {% if display_status == 'Closed' %}active{% endif %}">Closed</a></li>
          </div>
        </div>
      </ul>
    </div>
  </div>
  <div class="h-section section-resized">
    <!-- inicio navbar-boxes-->

    <!--fim navbar-boxes-->

    <!--inicio boxes-->
    <div class="row boxes-container">
      {% for box in object_list %}
      <div class="col-xxs-12 col-xs-6 col-sm-6 col-md-6 col-lg-4 space">
        <div class="box {% if box.uuid|lower == new_box %}new-box{% endif %}">
          <div class="box-content">
            <div class="box-container">
              <div class="basic-info">
                <div class="box-title-desc">
                  <h3 class="box__title text text-darkest">{{box.name}}</h3>
                  <p class="box__desc smalltext text-darkest">{{box.description}}</p>
                </div>
                <div class="box-action">
                  <form class="hoverable" action="{% url 'boxes_close' box.id %}" method="post">
                    {% csrf_token %}
                    <input class="btn-dark text outro" type="submit" value="CLOSE"/>
                  </form>
                  <form class="hoverable" action="{% url 'boxes_delete' box.id %}" method="post">
                    {% csrf_token %}
                    <input class="btn-dark text outro" type="submit" value="DELETE" />
                  </form>
                </div>
              </div>
            </div>
            {% if box.status == allow_actions %}
            <input class="barra" type="text" value="https://{{domain}}{% url "boxes_show" box.uuid %}" id="box-{{box.id}}-url" />
            <div class="row url_btn">
              <button class="btn-default copy-to-clipboard-js text col-xs-6" data-src='box-{{box.id}}-url'>COPY URL</button>
              <a class="btn-default text col-xs-6" href="{% url 'boxes_show' box.uuid %}" target="_blank">OPEN</a>
            </div>
            {% endif %}
            <div class="extra-info">
              <p class="smalltext text-darkest">Messages:{{box.messages.count}}/{{box.max_messages}}</p>
              <p class="box__info smalltext">
                <span class="text-darkest smalltext">Created on:</span>
                <span>{{box.created_at}}</span>
              </p>
              {% if box.expires_at %}
              <p class="box__info smalltext">
                <span class="text-darkest">Expires on:</span>
                <span>{{box.expires_at}}</span>
              </p>
              {% endif %}
              {% if box.messages.count %}
              <p class="box__info">
                <span class="text-darkest">Last sent:</span>
                <span>{{box.last_sent_at}}</span>
              </p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <div class="row">
      <div class="col-xs-offset-3 col-xs-6 center-xs">
        <div class="pagination text">
          <span class="step-links">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&amp;display={{ display_status }}" class=" text-darkest"> &lt; Previous</a>
            {% endif %}
            {% if paginator.num_pages > 1 %}
            <span class="current hidden">
              Page {{ page_obj.number }} of {{ paginator.num_pages }}
            </span>
            {% endif %}
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&amp;display={{ display_status }}" class="text-darkest">Next &gt; </a>
            {% endif %}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="md-modal-xs md-effect-1" id="modal-1">
  <div class="md-content-xs">
    <button type="button" class="md-close btn-none"><i class="fa fa-times fa-lg" aria-hidden="true"></i></button>
    <div class="row center-xs center-md center-lg">
      <div class="col-xs-12 col-sm-12 col-md-12">
        <h3 class="subtitle center-xs">Create New Box</h3>
        <p class="smalltext text-lightest"> For others to be able to send you encrypted content through Hawkpost, you'll need to generate "boxes".</p>
        <p class="smalltext text-lightest">  Each box has an associated link that you can copy and share with any given person. If you want, you can set the expiration date and number of messages after which the link will be locked and no longer accessible.</p>
        <span id="__all__-errors-js"></span>
        <form action="{% url 'boxes_create' %}" method="post" class="" id="box-create-form-js">
          {% csrf_token %}
          <label class="input-anim">
            <p>
              <span id="name-errors-js">{{ form.name.errors }}</span>
              {{ form.name.label_tag }}
              {{ form.name }}
            </p>
            <div class="row">
              <div class="col-xs-9 col-xxs-12 col-sm-9">
                <p>
                  <span id="description-errors-js">{{ form.description.errors }}</span>
                  {{ form.description.label_tag }}
                  {{ form.description }}
                </p>
              </div>
              <div class="col-xs-3 col-xxs-12 col-sm-3">
                <p>
                  <span id="max_messages-errors-js">{{ form.max_messages.errors }}</span>
                  {{ form.max_messages.label_tag }}
                  {{ form.max_messages }}
                </p>
                <br>
              </div>
            </div>
            <div class="row bottom-xs">
              <div class="col-xs-9 col-xxs-12 col-sm-8">
                <p>
                  <span id="expires_at-errors-js">{{ form.expires_at.errors }}</span>
                  {{ form.expires_at.label_tag }}
                  {{ form.expires_at }}
                </p>
              </div>
              <div class="col-xs-3 col-xxs-12 col-sm-4">
                <div class="row">
                  <div class="col-xs-10 col-xxs-8 sm-10">
                    <p><span id="never_expires-errors-js">{{ form.never_expires.errors }}</span>
                    {{ form.never_expires.label_tag }}</p>
                  </div>
                  <div class="col-xs-2 col-xxs-4 sm-2">
                    {{ form.never_expires }}
                  </div>
                </div>
              </div>
            </label>
            <div class="row middle-xs center-xs">
              <div class="col-xs-12">
                <button type="submit" class="btn-default" value="">Create</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="md-overlay"></div>
    </div>
  </div>
  {% endblock content %}

  {% block scripts %}
  {{ block.super }}
  <script src="{% static 'javascripts/box_list.js' %}"></script>
  <script type="text/javascript" src="{% static 'javascripts/jquery.datetimepicker.min.js' %}"></script>
  <script src="{% static 'javascripts/box_create.js' %}"></script>
  {% endblock scripts %}
